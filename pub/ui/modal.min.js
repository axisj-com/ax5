!function(root,ax_super){var U=ax5.util,axd=ax5.dom,ax_class=function(){this.main=function(){ax_super&&ax_super.call(this),this.config={click_event_name:"click",mask:{target:document.body,content:""},theme:"default",width:300,title:"",msg:""}}.apply(this,arguments),this.active_modal=null,this.mask=new ax5.ui.mask;var cfg=this.config;this.init=function(){cfg.id="ax5-modal-"+ax5.get_guid(),this.mask.set_config(cfg.mask)},this.alert=function(opts,callback){return U.is_string(opts)&&(opts={title:cfg.title,msg:opts}),opts.modal_type="alert",opts.theme=opts.theme||cfg.theme||"","undefined"==typeof opts.btns&&(opts.btns={ok:{label:"ok",theme:opts.theme}}),this.open(opts,callback),this},this.confirm=function(opts,callback){return U.is_string(opts)&&(opts={title:cfg.title,msg:opts}),opts.modal_type="confirm",opts.theme=opts.theme||cfg.theme||"","undefined"==typeof opts.btns&&(opts.btns={ok:{label:"ok",theme:opts.theme},cancel:{label:"cancel"}}),this.open(opts,callback),this},this.prompt=function(opts,callback){return U.is_string(opts)&&(opts={title:cfg.title,msg:opts}),opts.modal_type="prompt",opts.theme=opts.theme||cfg.theme||"","undefined"==typeof opts.input&&(opts.input={value:{label:opts.msg||cfg.msg||""}}),"undefined"==typeof opts.btns&&(opts.btns={ok:{label:"ok",theme:opts.theme},cancel:{label:"cancel"}}),this.open(opts,callback),this},this.get_content=function(modal_id,opts){var po=[];return po.push('<div id="'+modal_id+'" data-ax5-ui="modal" class="ax5-ui-modal '+opts.theme+'">'),po.push('<div class="ax-modal-heading">'),po.push(opts.title||cfg.title||""),po.push("</div>"),po.push('<div class="ax-modal-body">'),po.push('<div class="ax-modal-msg">'),opts.input?U.each(opts.input,function(k){po.push('<div class="ax-modal-prompt">'),po.push(this.label.replace(/\n/g,"<br/>")),po.push("</div>"),po.push('<input type="text" class="ax-inp" data-ax-modal-prompt="'+k+'" style="width:100%;" />')}):po.push((opts.msg||cfg.msg||"").replace(/\n/g,"<br/>")),po.push("</div>"),po.push('<div class="ax-modal-buttons">'),po.push('<div class="ax-button-wrap">'),U.each(opts.btns,function(k){po.push('<button type="button" data-ax-modal-btn="'+k+'" class="ax-btn '+this.theme+'">'+this.label+"</button>")}),po.push("</div>"),po.push("</div>"),po.push("</div>"),po.push("</div>"),po.join("")},this.open=function(opts,callback){var pos={},box={};opts.id=opts.id||cfg.id,this.mask.open(),box={width:opts.width||cfg.width},axd.append(document.body,this.get_content(opts.id,opts)),this.active_modal=ax5.dom("#"+opts.id),this.active_modal.css({width:box.width}),box.height=this.active_modal.height(),"undefined"==typeof opts.position||"center"===opts.position?(pos.top=ax5.dom.height(document.body)/2-box.height/2,pos.left=ax5.dom.width(document.body)/2-box.width/2):(pos.left=opts.position.left||0,pos.top=opts.position.top||0),this.active_modal.css(pos),"prompt"===opts.modal_type?this.active_modal.find("[data-ax-modal-prompt]").elements[0].focus():this.active_modal.find("[data-ax-modal-btn]").elements[0].focus(),this.active_modal.find("[data-ax-modal-btn]").on(cfg.click_event_name,function(e){this.btn_onclick(e||window.event,opts,callback)}.bind(this)),axd(window).on("keydown.ax-modal",function(e){this.onkeyup(e||window.event,opts,callback)}.bind(this))},this.btn_onclick=function(e,opts,callback,target,k){if(target=axd.parent(e.target,function(target){return ax5.dom.attr(target,"data-ax-modal-btn")?!0:void 0})){k=axd.attr(target,"data-ax-modal-btn");var that={key:k,value:opts.btns[k],modal_id:opts.id,btn_target:target};if("prompt"===opts.modal_type){var empty_key=null;for(var oi in opts.input)if(that[oi]=this.active_modal.find("[data-ax-modal-prompt="+oi+"]").val(),""==that[oi]||null==that[oi]){empty_key=oi;break}}if(opts.btns[k].onclick)opts.btns[k].onclick.call(that,k);else if("alert"===opts.modal_type)callback&&callback.call(that,k),this.close();else if("confirm"===opts.modal_type)callback&&callback.call(that,k),this.close();else if("prompt"===opts.modal_type){if("ok"===k&&empty_key)return this.active_modal.find('[data-ax-modal-prompt="'+empty_key+'"]').elements[0].focus(),!1;callback&&callback.call(that,k),this.close()}}},this.onkeyup=function(e,opts,callback,target,k){if(e.keyCode==ax5.info.event_keys.ESC&&this.close(),"prompt"===opts.modal_type&&e.keyCode==ax5.info.event_keys.RETURN){var that={key:k,value:opts.btns[k],modal_id:opts.id,btn_target:target},empty_key=null;for(var oi in opts.input)if(that[oi]=this.active_modal.find("[data-ax-modal-prompt="+oi+"]").val(),""==that[oi]||null==that[oi]){empty_key=oi;break}if(empty_key)return!1;callback&&callback.call(that,k),this.close()}},this.close=function(){return this.active_modal&&(this.active_modal.remove(),this.mask.close(),this.active_modal=null,axd(window).off("keydown.ax-modal")),this}};U.is_function(ax_super)&&(ax_class.prototype=new ax_super),root.modal=ax_class,"function"==typeof define&&define.amd&&define("_ax5_ui_modal",[],function(){return ax_class})}(ax5.ui,ax5.ui.root);